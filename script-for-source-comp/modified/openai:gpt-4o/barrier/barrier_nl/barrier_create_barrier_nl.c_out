struct barrier *create_barrier(int n)
{
struct barrier *barrier = malloc(sizeof(struct barrier));
if (barrier == 0) abort();
barrier->n = n;
barrier->k = 0;
barrier->outgoing = false;
struct mutex *mutex = create_mutex();
barrier->mutex = mutex;
return barrier;
}
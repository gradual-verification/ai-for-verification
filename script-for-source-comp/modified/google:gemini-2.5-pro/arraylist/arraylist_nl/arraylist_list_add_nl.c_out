struct arraylist {
void **data;
int size;
int capacity;
};
void list_add(struct arraylist *a, void *v)
{
int size = 0;
void** data = 0;
if(a->capacity <= a->size) {
data = a->data;
size = a->size;
int capacity = a->capacity;
if (SIZE_MAX / sizeof(void *) < (size_t)capacity * 2 + 1) abort();
int new_capacity = capacity * 2 + 1;
void** newData = malloc(((size_t)new_capacity) * sizeof(void*));
if(newData == 0) abort();
memcpy(newData, data, (size_t)size * sizeof(void*));
a->data = newData;
if (INT_MAX / 2 - 1 < capacity) abort();
a->capacity = new_capacity;
free(data);
}
size = a->size;
data = a->data;
data[size] = v;
a->size += 1;
}
invariant l->readers |-> length(reader_handles);
struct rwlock {
struct mutex *mutex;
int readers;
};
void reader(struct rwlock *l)
{
mutex_acquire(l->mutex);
if (l->readers == INT_MAX) {
abort();
}
l->readers++;
mutex_release(l->mutex);
mutex_acquire(l->mutex);
if (l->readers == 0) {
abort();
}
l->readers--;
mutex_release(l->mutex);
}
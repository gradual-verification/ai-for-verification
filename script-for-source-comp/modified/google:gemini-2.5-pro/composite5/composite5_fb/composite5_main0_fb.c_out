struct node {
struct node *firstChild;
struct node *nextSibling;
struct node *parent;
int count;
};
struct node *create_node(struct node *p, struct node *next)
{
struct node *n = malloc(sizeof(struct node));
if (n == 0) abort();
n->firstChild = 0;
n->nextSibling = next;
n->parent = p;
n->count = 1;
return n;
}
struct node *create_tree()
{
struct node *n = create_node(0, 0);
return n;
}
void add_to_count(struct node *p, int delta)
{
struct node *pp = p->parent;
if (p->count > INT_MAX - delta)
abort();
p->count += delta;
if (pp == 0) {
} else {
add_to_count(pp, delta);
}
}
struct node *tree_add(struct node *node)
{
struct node *n = create_node(node, node->firstChild);
node->firstChild = n;
add_to_count(node, 1);
return n;
}
struct node *tree_get_parent(struct node *node)
{
struct node *p = node->parent;
return p;
}
int main0()
{
struct node *node = create_tree();
node = tree_add(node);
node = tree_add(node);
node = tree_get_parent(node);
if (node == 0) abort();
node = tree_add(node);
node = tree_get_parent(node);
if (node == 0) abort();
node = tree_get_parent(node);
if (node == 0) abort();
return 0;
}